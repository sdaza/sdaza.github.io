{% if site.enable_progressbar %}

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * Adapted from https://css-tricks.com/reading-position-indicator/
   * by Pankaj Parashar. Updated for vanilla JS (no jQuery).
   */
  var progressBar = document.getElementById("progress");

  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };

  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      document.addEventListener("scroll", function () {
        progressBar.setAttribute("value", getCurrentScrollPosition());
      });
      window.addEventListener("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      document.addEventListener("scroll", resizeProgressBar);
      window.addEventListener("resize", resizeProgressBar);
    }
  }

  function getCurrentScrollPosition() {
    return window.scrollY || document.documentElement.scrollTop;
  }

  function initializeProgressElement() {
    var navbar = document.getElementById("navbar");
    var navbarHeight = navbar ? navbar.offsetHeight : 0;
    document.body.style.paddingTop = navbarHeight + "px";
    progressBar.style.top = navbarHeight + "px";
    progressBar.setAttribute("max", getDistanceToScroll());
    progressBar.setAttribute("value", getCurrentScrollPosition());
  }

  function getDistanceToScroll() {
    return document.documentElement.scrollHeight - window.innerHeight;
  }

  function resizeProgressBar() {
    progressBar.style.width = getWidthPercentage() + "%";
  }

  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

{%- endif %}
